{% extends "ApplicationEpostBundle::layoutn.html.twig" %}

  {% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" href="{{ asset('bundles/applicationepost/css/sliding.css') }}" type="text/css" media="all"/>
<link rel="stylesheet" href="{{ asset('css/news.css') }}" type="text/css" media="all"/>
<style>  
        /* override free days background in jquery ui datepicker */
.free-day {
  background: #2e9500;
}
 
.free-day a {
  opacity: 0.7;
}
        div.ui-datepicker {
            font-size: 95%;
        }
        /*.dp-highlight-unknown .ui-state-default {
                        background: #800;
                        color: #FFF;
                }
                .dp-highlight-holiday .ui-state-default {
                        background: #484;
                        color: #FFF;
                }*/
    </style>
{% endblock %}


{% block javascripts %}
{{ parent() }}
<!--<script type="text/javascript" src="{{ asset('bundles/applicationepost/js/selectapplis.js') }}"></script>
    -->
    <script type="text/javascript" src="{{ asset('jquery/jquery.raty.js') }}"></script>
    <script type="text/javascript">
      /*  $(document).ready(function(){*/
       $('.star').raty({
           readOnly: true,
     score: function() {
       return $(this).attr('data-score');
     }
   });
   // declare freeDays global
   var eventsDays = [];
   // perform initial json request for free days
/*fetchFreeDays();*/
   $('#datepicker').datepicker({
       dateFormat: 'dd-m-yy',
       inline: true,
       changeMonth: true,
       changeYear: true,
       showOtherMonths: true,
       selectOtherMonths: true,
       beforeShowDay: highlightDays,
       onChangeMonthYear: fetchEvents,
       firstDay: 1 // rows starts on Monday
           });
   function fetchEvents(year, month){
         console.log("month:" + month);
        var dataAjax = {
       'year':year,
        'month':month
    };
     $.ajax({
           async: false,
           url: "{{ path('epost_calendar') }}", 
           type: "POST", 
           data : dataAjax, 
           dataType: "json", 
           success: function(reponse){
               // Sur Succès de la réponse AJAX
               var optionData = reponse;
                /* console.log("datas:" + optionData);*/
                  $.each(optionData, function(index, value) {
                  /*    console.log("value=" + value);*/
               eventsDays.push(value.date); 
              // add this date to the freeDays array
           });
    
    console.log("datas=" +  eventsDays);
    /*highlightDays(date);*/
       }
       });
       }
    
    
       // runs for every day displayed in datepicker, adds class and tooltip if matched to days in freeDays array
   function highlightDays(date)
   {
       for (var i = 0; i < eventsDays.length; i++) {
         if (new Date(eventsDays[i]).toString() == date.toString()) {
              console.log("found DAY datas=" +  eventsDays[i]);
            return [true, 'free-day', 'no to-do items due'];
          // [0] = true | false if this day is selectable, [1] = class to add, [2] = tooltip to display
         }
       }
 
       return [true, ''];
   }
        </script>

{% endblock %}


{% block content_header '' %}
{% block title %}
        ARTICLES


{% endblock %}
{% block content %}


{% for type, flashMessages in app.session.flashbag.all() %}
    {% for flashMessage in flashMessages %}
        <div class="alert alert-{{ type }}">
            {{ flashMessage|trans }}
            </div>
    {% endfor %}
{% endfor %}

{#
{% if is_granted("ROLE_USER") %}   
<a href="{{ path('epost_new') }}" class="btn btn-medium btn-primary"><i class="icon-plus"></i> Ajouter un Post</a>
{% endif %}#}
            <br><br>


  {#{% for post in pager.getResults() %}#}
      {% for entity in paginationa %}


            <div class="mypost">
                <table><tr><td>
               {{ entity.createdAt|created_ago }} -    

        {% if entity.globalnote is not null %}
   {#    Note Globale: #}
                                        <div class="star" data-score="{{ entity.globalnote }}"></div>
           {#({{ entity.globalnote }})#}
        {% else %}
                                        <div class="star" data-score="0"></div>
        {#({{ entity.globalnote }})#}
        {% endif %}</td><td>
                          {% if entity.categorie is not null %}               
                                        <span class="label">

                                            <a href="{{ url('epost_categories_show', {'categorie': entity.categorie.slug} ) }}">
{{ entity.categorie.name }}</a>
                                            </span>
                  {% else %}
                                            pas de catégorie
                  {% endif %}
                     {#<span class="label label-inverse">#}
                {#  {{ entity.tags|join(', ') }}    </span>#}
                   {% for tag in entity.tags %}
                                            <span class="label label-inverse">
                                                <a href="{{ url('epost_tags_show', {'tag': tag.slug} ) }}">{{ tag.name }}</a>
                            {% if not loop.last%} {%endif%}
                                            </span>
                            {% else %}
                                            Pas de Tag
                        {% endfor %}

                                        </td></tr></table>



                                <!--   <h2 class="entry-title">-->
                                <h2 class="sonata-blog-post-title">
                                    <img src="{% path entity.imageMedia, 'small' %}" width="100" /> 

                                    <span class="sonata-blog-post-author"> 

                                        <a href="{{ path('epost_showstandard', { 'blog_id': entity.id,'slug': entity.slug }) }}">
                          {{ entity.name }}</a>
    {% if entity.proprietaire is not null %}               
                                            Par {{ entity.proprietaire.username }}
                 {% else %}
                                            xxx
                     {% endif %}</span>
                                    </h2>
                                    <br>
                                    <div class="sonata-blog-post-abtract">
                                        Extrait:  {{ entity.resume|raw }}
                                    </div><br>


            {% if entity.commentscount is not null %}
            {% if entity.commentscount > 1 %}
                                    <span class="badge badge-warning">{{ entity.commentscount }} commentaires</span>
              {% else %}
                                    <span class="badge badge-warning">{{ entity.commentscount }} commentaire</span>
                  {% endif %}
              {% else %}
                                    <span class="badge badge-warning">0 commentaire</span>

                      {% endif %}
                                    <a href="{{ path('epost_showstandard', { 'blog_id': entity.id,'slug': entity.slug }) }}">
                                        <img src="{{ asset('bundles/applicationepost/images/detail.png') }}" alt="show" width="15" height="15" />
                                    </a>

                                </div>

    {% endfor %}
 {{ knp_pagination_render(paginationa) }}

{% endblock %}




{% block categories %}
{{ parent() }}
{% include 'ApplicationEpostBundle:sidebar:sidebarcategories.html.twig' %}
{% endblock %}



{% block tags %}
{{ parent() }}
{% include 'ApplicationEpostBundle:sidebar:sidebartags.html.twig' %}
{% endblock %}



{% block comments %}
{% include 'ApplicationEpostBundle:sidebar:lastcomments.html.twig' %}
{% endblock %}


{% block archives %}
{{ parent() }}
{% include 'ApplicationEpostBundle:sidebar:sidebaryears.html.twig' %}
{% endblock %}

{% block datepick %}
{{ parent() }}

	{#<p><input id="dateloader" type="button" value=" Load dates "></p>#}
                                <div id="datepicker"></div>
{% endblock %}